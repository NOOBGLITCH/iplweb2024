<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Sports - Clappr Landscape</title>
  <meta name="referrer" content="no-referrer">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">

  <!-- Clappr -->
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>

  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      background: #000; overflow: hidden;
      font-family: Arial, sans-serif;
    }
    #player { width: 100%; height: 100%; background: #000; }
    .watermark {
      position: absolute; bottom: 10%; right: 10px;
      opacity: .5; color: #fff; font-weight: bold;
      pointer-events: none; z-index: 2002;
    }
  </style>
</head>
<body>
  <div id="player"></div>
  <div class="watermark">@NOOBGLITCH</div>

  <script>
    const apiUrl = "https://raw.githubusercontent.com/abusaeeidx/CricHd-playlists-Auto-Update-permanent/main/api.json";
    const urlParams = new URLSearchParams(window.location.search);
    let targetId = urlParams.get("id") || "starhindi";
    let currentUrl = "";
    let clapprPlayer;

    async function fetchStreamUrl() {
      const res = await fetch(apiUrl);
      if (!res.ok) throw new Error("Failed to fetch API");
      const data = await res.json();
      const channel = data.find(item => item.id === targetId);
      if (!channel) throw new Error("Stream not found");
      return channel.link;
    }

    async function initClappr() {
      try {
        currentUrl = await fetchStreamUrl();
        clapprPlayer = new Clappr.Player({
          source: currentUrl,
          parentId: "#player",
          autoPlay: false,
          width: "100%", height: "100%",
          mute: false
        });

        // Refresh stream every 10 min
        setInterval(async () => {
          try {
            const freshUrl = await fetchStreamUrl();
            if (freshUrl !== currentUrl) {
              currentUrl = freshUrl;
              clapprPlayer.load(freshUrl);
              console.log("ðŸ”„ Stream refreshed:", new Date().toLocaleTimeString());
            }
          } catch (err) { console.error(err); }
        }, 10 * 60 * 1000);

      } catch (err) {
        document.body.innerHTML = `<h2 style='color:white;text-align:center;'>${err.message}</h2>`;
      }
    }

    initClappr();

    // ðŸ“± Force LANDSCAPE after entering fullscreen
    document.addEventListener("fullscreenchange", () => {
      if (document.fullscreenElement && screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("landscape").catch(err => {
          console.log("Orientation lock failed:", err);
        });
      }
    });
  </script>
</body>
</html>
