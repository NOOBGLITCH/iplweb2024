<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Player</title>
    <style>
        html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: sans-serif; }
        #player { position: absolute; width: 100% !important; height: 100% !important; }
    </style>
</head>
<body>

    <div id="player"></div>

    <script src='https://content.jwplatform.com/libraries/KB5zFt7A.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const playerContainerId = 'player';
        const apiUrl = 'https://maxplay-tv.fun/cric.php?id=starhindi';
        const directM3u8Url = 'https://off1.dunyapurkaraja.com:1686/hls/starhindi.m3u8?md5=p99AG0dgfFFJ0UE9xqsSpw&expires=1743685958';
        const useApi = false; // Force using the direct URL for this test
        const streamTitle = "star sports 1 hindi";

        function setupPlayer(m3u8Url) {
            if (typeof jwplayer === 'undefined') {
                console.error("JWPlayer library not loaded.");
                alert("Error: Video player library failed to load.");
                return;
            }

            window.playerInstance = jwplayer(playerContainerId).setup({
                file: m3u8Url,
                width: "100%",
                aspectratio: "16:9",
                autostart: true,
                primary: "html5",
                hlsjs: Hls,
                preload: "auto",
                stretching: "uniform",
                pip: true,
                controls: true,
                title: streamTitle
            }).on('error', event => {
                console.error('JWPlayer Error:', event.message, event);
                alert(`Error loading the stream: ${event.message} (Error Code: ${event.code || 'N/A'})`);
            });

            console.log('JWPlayer setup initiated with URL:', m3u8Url);
        }

        async function fetchM3u8Url() {
            if (!useApi) {
                console.log('Attempting to play direct stream URL:', directM3u8Url);
                setupPlayer(directM3u8Url);
                return;
            }

            console.log('Fetching stream URL from API:', apiUrl);
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    console.error('API Response Error:', response.status, response.statusText);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.text();
                const fetchedM3u8Url = data.trim();
                console.log('Fetched stream URL from API:', fetchedM3u8Url);
                if (fetchedM3u8Url) {
                    setupPlayer(fetchedM3u8Url);
                } else {
                    console.warn('API returned empty URL. Using direct URL as fallback.');
                    setupPlayer(directM3u8Url);
                }
            } catch (error) {
                console.error('Error fetching from API:', error);
                console.log('Using direct stream URL as fallback.');
                setupPlayer(directM3u8Url);
            }
        }

        document.addEventListener('DOMContentLoaded', fetchM3u8Url);
    </script>

</body>
</html>