<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NOOBGLITCH Player</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css">
  <style>
    body, html { margin: 0; background: #000; height: 100%; overflow: hidden; }
    .plyr { height: 100%; width: 100%; }
    video { object-fit: contain; }

    /* RED WATERMARK */
    .wm {
      position: absolute;
      top: 50px; 
      right: 20px;
      color: #FF0000;
      font-family: Arial, sans-serif;
      font-weight: bold;
      font-size: 18px;
      text-transform: uppercase;
      opacity: 2;
      z-index: 10;
      pointer-events: none;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      user-select: none;
    }
  </style>
</head>
<body>

<div class="wm">@NOOBGLITCH</div>
<video id="player" playsinline crossorigin></video>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.min.js"></script>

<script>
  const video = document.getElementById('player');
  const source = new URLSearchParams(window.location.search).get("url") || "https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8";

  // Optimization Config for Faster Loading
  const hlsConfig = {
    enableWorker: true,        // Offload processing to a web worker
    lowLatencyMode: true,      // Reduces delay for live streams
    backBufferLength: 30,      // Keeps less memory used
    maxBufferLength: 10,       // Don't wait to buffer too much before starting
    maxMaxBufferLength: 20,
    startLevel: -1,            // Auto-detect best start quality
    abandonFragmentTimeout: 3000 // Quickly switch if a segment is slow
  };

  if (Hls.isSupported()) {
    const hls = new Hls(hlsConfig);
    hls.loadSource(source);
    hls.attachMedia(video);
    
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      const levels = hls.levels.map(l => l.height);
      const qualityOptions = [0, ...levels]; 
      
      const player = new Plyr(video, {
        autoplay: true, // Attempt to play immediately
        quality: {
          default: 0,
          options: qualityOptions,
          forced: true,
          onChange: (newQuality) => {
            if (newQuality === 0) hls.currentLevel = -1; 
            else hls.currentLevel = hls.levels.findIndex(l => l.height === newQuality);
          }
        }
      });
      video.play(); // Direct play call for speed
    });
    window.hls = hls; 
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = source; 
    const player = new Plyr(video, { autoplay: true });
    video.play();
  }
</script>
</body>
</html>