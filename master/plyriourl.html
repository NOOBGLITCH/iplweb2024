<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NOOBGLITCH Player</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css">
  <style>
    body, html { margin: 0; background: #000; height: 100%; overflow: hidden; }
    .plyr { height: 100%; width: 100%; }
    video { object-fit: contain; }

    /* RED WATERMARK */
    .wm {
      position: absolute;
      top: 50px; 
      right: 20px;
      color: #FF0000;
      font-family: Arial, sans-serif;
      font-weight: bold;
      font-size: 18px;
      text-transform: uppercase;
      opacity: 2; /* Reduced slightly for better visibility of video */
      z-index: 10;
      pointer-events: none;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      user-select: none;
    }

    /* Ensure Plyr takes up full height for orientation shifts */
    .plyr--video {
      height: 100% !important;
    }
  </style>
</head>
<body>

<div class="wm">@NOOBGLITCH</div>
<video id="player" playsinline crossorigin></video>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.min.js"></script>

<script>
  const video = document.getElementById('player');
  const source = new URLSearchParams(window.location.search).get("url") || "https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8";

  // Optimization Config for Faster Loading
  const hlsConfig = {
    enableWorker: true,
    lowLatencyMode: true,
    backBufferLength: 30,
    maxBufferLength: 10,
    maxMaxBufferLength: 20,
    startLevel: -1,
    abandonFragmentTimeout: 3000
  };

  function initializePlayer(playerInstance, hlsInstance = null) {
    // Landscape Support Logic
    playerInstance.on('enterfullscreen', () => {
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(err => {
          console.warn("Orientation lock ignored:", err);
        });
      }
    });

    playerInstance.on('exitfullscreen', () => {
      if (screen.orientation && screen.orientation.unlock) {
        screen.orientation.unlock();
      }
    });
  }

  if (Hls.isSupported()) {
    const hls = new Hls(hlsConfig);
    hls.loadSource(source);
    hls.attachMedia(video);
    
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      const levels = hls.levels.map(l => l.height);
      const qualityOptions = [0, ...levels]; 
      
      const player = new Plyr(video, {
        autoplay: true,
        quality: {
          default: 0,
          options: qualityOptions,
          forced: true,
          onChange: (newQuality) => {
            if (newQuality === 0) hls.currentLevel = -1; 
            else hls.currentLevel = hls.levels.findIndex(l => l.height === newQuality);
          }
        }
      });

      initializePlayer(player, hls);
      video.play().catch(() => {
        console.log("Autoplay blocked, waiting for user interaction.");
      });
    });
    window.hls = hls; 
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    // For Safari/iOS native HLS support
    video.src = source; 
    const player = new Plyr(video, { autoplay: true });
    initializePlayer(player);
    video.play();
  }
</script>
</body>
</html>
